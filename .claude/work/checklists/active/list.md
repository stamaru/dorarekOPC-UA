# **工場設備停止時ビデオ記録・分析システム構築 詳細ステップリスト**
2025-06-02

## **フェーズ1: 計画・準備**

* \[ \] **プロジェクトチーム編成と役割定義**  
  * \[ \] プロジェクトマネージャー、開発エンジニア（エッジ、クラウド、AI）、インフラ担当、テスト担当、関係部門代表者などをアサイン。  
  * \[ \] 各担当者の役割と責任範囲を明確化。  
* \[ \] **要件定義の最終確認と詳細化**  
  * \[ \] システム概要設計に基づき、機能要件、非機能要件（性能、セキュリティ、可用性など）を再確認。  
  * \[ \] 対象設備、OPC-UAタグ情報、映像記録時間（停止信号の前後）、AI分類カテゴリなどを具体的に定義。  
  * \[ \] ユーザーインターフェース/UX要件（映像閲覧、分析結果確認画面など）の定義（必要な場合）。  
* \[ \] **技術仕様の詳細設計**  
  * \[ \] 使用するハードウェア（IPカメラ、エッジゲートウェイ機種）、ソフトウェア（OS、ミドルウェア、ライブラリ）、クラウドサービス（具体的なサービスプラン）の最終決定。  
  * \[ \] ネットワーク構成図（工場内、クラウド接続）、データフロー図、シーケンス図などの詳細設計。  
  * \[ \] データベーススキーマ設計（メタデータ管理用）。  
  * \[ \] APIインターフェース設計（エッジ-クラウド間、AIサービス連携など）。  
* \[ \] **リスク分析と対策計画**  
  * \[ \] 技術的リスク、スケジュール遅延リスク、コスト超過リスクなどを洗い出し、対応策を計画。  
* \[ \] **プロジェクト計画策定**  
  * \[ \] WBS（Work Breakdown Structure）の作成。  
  * \[ \] 各タスクのスケジュール、担当者、成果物を定義。  
  * \[ \] マイルストーン設定。  
  * \[ \] コミュニケーション計画、会議体設定。  
* \[ \] **予算確保とリソース調達**  
  * \[ \] ハードウェア、ソフトウェア、クラウドサービス利用料、人件費などの予算を確定。  
  * \[ \] 必要な機材、ライセンス、アカウントなどを調達。  
* \[ \] **開発・テスト環境構築準備**  
  * \[ \] 開発用PC、テスト用エッジデバイス、クラウド開発環境の準備計画。

## **フェーズ2: インフラ構築**

* \[ \] **エッジ層インフラ構築**  
  * \[ \] IPカメラの設置とネットワーク接続、初期設定。  
  * \[ \] エッジゲートウェイの設置、電源確保（UPS含む）、ネットワーク接続。  
  * \[ \] エッジゲートウェイへのOSインストールと基本設定（セキュリティ設定含む）。  
  * \[ \] 必要なミドルウェア、ライブラリ（GStreamer, OPC-UAライブラリ等）のインストールと設定。  
* \[ \] **クラウド層インフラ構築**  
  * \[ \] クラウドプロバイダーアカウントと組織構造の設定。  
  * \[ \] 仮想プライベートクラウド（VPC）/仮想ネットワーク（VNet）設計と構築。  
  * \[ \] オブジェクトストレージ（S3, Azure Blob等）のバケット/コンテナ作成と設定（バージョニング、ライフサイクルポリシー初期設定、アクセス権限）。  
  * \[ \] 映像AIサービスのアカウント設定、APIキー取得。  
  * \[ \] データベースサービスの設定（メタデータ保管用）。  
  * \[ \] IAM（Identity and Access Management）設定（ユーザー、ロール、ポリシー）。  
  * \[ \] ネットワークセキュリティ設定（ファイアウォールルール、セキュリティグループ）。  
  * \[ \] 監視・ロギングサービス（CloudWatch, Azure Monitor等）の初期設定。  
* \[ \] **ネットワーク設定と接続確認**  
  * \[ \] 工場内LANとエッジゲートウェイ間の通信設定。  
  * \[ \] エッジゲートウェイからクラウドへのインターネット接続設定と疎通確認。  
  * \[ \] セキュアな通信路の確立（VPN、専用線など、必要に応じて）。

## **フェーズ3: エッジゲートウェイ開発**

* \[ \] **OPC-UAクライアントモジュール開発**  
  * \[ \] 指定されたOPC-UAサーバーへの接続機能実装。  
  * \[ \] 監視対象ノード（例: MachineryItemState）のサブスクリプションまたはポーリング機能実装。  
  * \[ \] 設備停止信号検知ロジック（状態変化の判定）実装。  
  * \[ \] 検知時のタイムスタンプ取得とイベント通知機能実装。  
  * \[ \] エラーハンドリング、再接続処理実装。  
* \[ \] **映像処理・バッファリングモジュール開発 (GStreamer等)**  
  * \[ \] IPカメラからの映像ストリーム受信機能実装 (RTSP等)。  
  * \[ \] 循環バッファ（リングバッファ）への常時記録機能実装。  
    * \[ \] バッファサイズ、上書きポリシー設定。  
    * \[ \] H.265等でのエンコーディング設定。  
  * \[ \] OPC-UA停止信号トリガーに基づく映像クリッピング機能実装。  
    * \[ \] 指定された前後秒数の映像切り出しロジック。  
    * \[ \] 切り出し映像のファイル保存形式、命名規則定義。  
  * \[ \] メタデータ（タイムスタンプ、設備ID、トリガー情報等）生成・付与機能。  
* \[ \] **セキュアアップロードモジュール開発**  
  * \[ \] 切り出された映像クリップとメタデータのクラウドストレージへのアップロード機能実装。  
    * \[ \] HTTPS等セキュアプロトコル使用。  
    * \[ \] 認証情報管理（セキュアな方法で）。  
    * \[ \] 分割アップロード、リトライ処理実装。  
  * \[ \] アップロード成功/失敗の管理とロギング。  
  * \[ \] ネットワーク障害時のキューイングと再送メカニズム実装。  
  * \[ \] データ整合性チェック（チェックサム等）実装（オプション）。  
* \[ \] **ローカル管理・監視機能開発**  
  * \[ \] エッジゲートウェイのストレージ容量監視。  
  * \[ \] 循環バッファ、イベントクリップ用ストレージの管理ポリシー実装（満杯時対応など）。  
  * \[ \] アプリケーションログ出力機能。  
  * \[ \] UPS連携による安全なシャットダウン処理実装。  
* \[ \] **コンテナ化とデプロイ準備**  
  * \[ \] 各モジュール（OPC-UAクライアント、映像処理、アップローダー）をDockerコンテナ等でパッケージ化。  
  * \[ \] コンテナオーケストレーション設定（必要な場合）。  
  * \[ \] デプロイメントスクリプト作成。

## **フェーズ4: クラウド連携開発**

* \[ \] **映像アップロードAPI連携**  
  * \[ \] エッジからの映像・メタデータ受信APIエンドポイント開発（クラウド側で必要な場合、またはSDK利用）。  
  * \[ \] クラウドストレージへの確実なデータ格納処理。  
* \[ \] **メタデータ管理システム開発**  
  * \[ \] 映像クリップに紐づくメタデータ（設備ID、タイムスタンプ、OPC-UA情報、AI分析結果等）をデータベースに登録・管理する機能。  
  * \[ \] メタデータ検索・参照API開発。  
* \[ \] **AI分析トリガー設定**  
  * \[ \] クラウドストレージへの新規オブジェクト作成をトリガーとして、映像AIサービスを起動する設定（Lambda関数、Cloud Functions、Event Grid等）。  
  * \[ \] AI分析サービスへの映像パス、分析パラメータ等の受け渡し設定。  
* \[ \] **分析結果の格納と連携**  
  * \[ \] 映像AIサービスからの分析結果（分類カテゴリ、信頼度スコア、タイムスタンプ等）を受信。  
  * \[ \] 分析結果をメタデータとしてデータベースに更新・保存。  
  * \[ \] 必要に応じて他システム（監視システム、BIツール等）への通知・連携機能開発。  
* \[ \] **ユーザーインターフェース開発（必要な場合）**  
  * \[ \] 保管された映像の検索・再生画面。  
  * \[ \] AIによる分類結果の表示画面。  
  * \[ \] 管理者向け設定画面。

## **フェーズ5: AIモデル開発・導入**

* \[ \] **データ収集・ラベリング戦略策定**  
  * \[ \] AIによる自動分類の対象となるイベントカテゴリ（正常停止、異常停止種別、特定作業など）を定義。  
  * \[ \] 各カテゴリの教師データ収集計画（既存映像の活用、模擬的な事象発生による撮影など）。  
  * \[ \] ラベリングツール選定とラベリング作業手順の標準化。  
  * \[ \] アノテーターへのトレーニング。  
* \[ \] **初期データ収集とラベリング**  
  * \[ \] 計画に基づき、各カテゴリの映像クリップ（またはフレーム）を収集。  
  * \[ \] 収集したデータに対して、定義したカテゴリのラベルを付与。  
  * \[ \] データ品質の確認とクレンジング。  
* \[ \] **事前学習済みモデルの評価**  
  * \[ \] クラウドAIサービスの標準機能（物体検出、シーン検出など）が要件に合致するか評価。  
  * \[ \] ラベリング済みデータの一部を用いて、事前学習済みモデルの分類精度を検証。  
* \[ \] **カスタム分類モデルのトレーニングと評価（初期）**  
  * \[ \] AutoMLツールまたはカスタムトレーニング環境を使用して、収集・ラベリングしたデータで分類モデルをトレーニング。  
  * \[ \] トレーニング済みモデルの精度評価（精度、再現率、F1スコアなど）。  
  * \[ \] ハイパーパラメータ調整、特徴量エンジニアリングによるモデル改善。  
  * \[ \] 複数のモデルバージョンを比較検討。  
* \[ \] **AIモデルのデプロイとAPI統合**  
  * \[ \] 評価済みのカスタムモデルをクラウドAIサービスにデプロイ。  
  * \[ \] デプロイしたモデルを呼び出すためのAPIエンドポイント設定。  
  * \[ \] クラウド連携モジュールからAI分析APIを呼び出し、新しい映像を分類する処理を実装。

## **フェーズ6: テスト**

* \[ \] **単体テスト**  
  * \[ \] エッジゲートウェイの各モジュール（OPC-UA、映像処理、アップロード）の個別テスト。  
  * \[ \] クラウド側の各コンポーネント（API、メタデータ管理、AI連携）の個別テスト。  
  * \[ \] AIモデルの分類精度テスト。  
* \[ \] **結合テスト**  
  * \[ \] OPC-UA信号受信から映像クリッピングまでの連携テスト。  
  * \[ \] 映像クリッピングからクラウドストレージへのアップロード連携テスト。  
  * \[ \] クラウドストレージへのアップロードからAI分析実行、結果保存までの連携テスト。  
* \[ \] **総合テスト（シナリオベース）**  
  * \[ \] 実際の設備停止シナリオを想定したエンドツーエンドのテスト。  
    * \[ \] 正常な設備停止ケース。  
    * \[ \] 異常な設備停止ケース（複数パターン）。  
    * \[ \] ネットワーク断、電源断からの復旧シナリオ。  
  * \[ \] ユーザーインターフェース操作テスト（必要な場合）。  
* \[ \] **パフォーマンステスト・負荷テスト**  
  * \[ \] エッジゲートウェイの処理性能測定（同時カメラ接続数、映像処理遅延など）。  
  * \[ \] クラウドへのアップロードスループット測定。  
  * \[ \] AI分析処理時間測定。  
  * \[ \] 高負荷状態（多数の設備同時停止など）でのシステム安定性テスト。  
* \[ \] **セキュリティテスト**  
  * \[ \] 脆弱性スキャン（エッジOS、クラウド環境）。  
  * \[ \] アクセス制御テスト（不正アクセス試行）。  
  * \[ \] データ暗号化検証。  
  * \[ \] OPC-UA通信セキュリティ検証。  
* \[ \] **ユーザビリティテスト（必要な場合）**  
  * \[ \] 実際の利用者にシステムを操作してもらい、使いやすさに関するフィードバックを収集。

## **フェーズ7: パイロット導入・評価**

* \[ \] **パイロット導入計画**  
  * \[ \] 対象とする設備範囲、期間、評価指標を決定。  
  * \[ \] 関係者への説明と協力体制構築。  
* \[ \] **実環境への限定的導入**  
  * \[ \] 選定した設備にシステムを設置・設定。  
  * \[ \] 運用担当者への初期トレーニング。  
* \[ \] **運用テストとフィードバック収集**  
  * \[ \] 実際の設備稼働状況下でのシステム動作監視。  
  * \[ \] 設備停止イベント発生時の映像記録、クラウドアップロード、AI分類の確認。  
  * \[ \] 運用担当者からのフィードバック（使い勝手、改善要望など）を収集。  
* \[ \] **課題特定と改善**  
  * \[ \] パイロット運用中に発生した問題点（バグ、性能不足、AI誤分類など）を分析。  
  * \[ \] システム設定の調整、ソフトウェアの修正、AIモデルの再学習など、改善策を実施。  
  * \[ \] 改善後の再評価。  
* \[ \] **導入効果測定**  
  * \[ \] 事前に設定した評価指標に基づき、システムの有効性を評価（原因究明時間短縮効果など）。

## **フェーズ8: 本番展開**

* \[ \] **本番展開計画**  
  * \[ \] パイロット導入の結果を踏まえ、全対象設備への展開スケジュール、手順を策定。  
  * \[ \] 必要なリソース（人員、機材）の再評価と確保。  
* \[ \] **全対象への展開作業**  
  * \[ \] 計画に基づき、システムを順次対象設備へ設置・設定。  
* \[ \] **運用体制構築**  
  * \[ \] システム監視、障害対応、問い合わせ対応などの運用フローを確立。  
  * \[ \] 運用担当者の配置と権限設定。  
* \[ \] **ドキュメント整備**  
  * \[ \] 運用マニュアル、ユーザートレーニング資料、システム構成図、障害対応手順書などを最終化。  
* \[ \] **ユーザートレーニング実施**  
  * \[ \] システム利用者、運用担当者に対するトレーニングを実施。  
* \[ \] **本番稼働開始**  
  * \[ \] 最終確認後、システムの本番運用を開始。  
  * \[ \] 稼働初期の集中監視。

## **フェーズ9: 運用・保守・改善**

* \[ \] **システム監視とアラート対応**  
  * \[ \] エッジゲートウェイ、クラウドサービス、ネットワークの常時監視。  
  * \[ \] 異常検知時のアラート通知と迅速な障害対応。  
* \[ \] **定期メンテナンス**  
  * \[ \] OS、ミドルウェア、セキュリティパッチの定期的な適用。  
  * \[ \] ハードウェアの点検・清掃。  
  * \[ \] データバックアップの確認。  
* \[ \] **AIモデルの継続的な再トレーニングと改善 (MLOps)**  
  * \[ \] 定期的なAI分類精度のモニタリング。  
  * \[ \] 誤分類されたデータや新しい事象のデータを収集・ラベリング。  
  * \[ \] 収集データを用いたAIモデルの再トレーニングと評価、デプロイ。  
  * \[ \] モデルのドリフト（時間経過による精度劣化）対策。  
* \[ \] **機能追加・改善**  
  * \[ \] ユーザーからのフィードバックや新たなニーズに基づき、システムの機能追加や改善を計画・実施。  
  * \[ \] 技術トレンドの変化に対応したシステムアップデート。  
* \[ \] **コスト最適化**  
  * \[ \] クラウドサービス利用状況の定期的なレビューとコスト最適化策の実施（ストレージ階層変更、インスタンスタイプ見直しなど）。  
* \[ \] **セキュリティ監査とアップデート**  
  * \[ \] 定期的なセキュリティ監査の実施。  
  * \[ \] 新たな脅威に対応するためのセキュリティ対策アップデート。

このステップリストは一般的なものであり、実際のプロジェクトの特性や制約に応じて調整が必要です。